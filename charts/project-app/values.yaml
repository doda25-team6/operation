
# Default application container configuration
image:
  repository: ghcr.io/doda25-team6/app
  tag: "0.0.97"
  pullPolicy: IfNotPresent

# Number of application replicas
replicaCount: 3

# Kubernetes service configuration
service:
  type: ClusterIP
  port: 8080

# Ingress configuration for external access
ingress:
  enabled: true
  className: "nginx"
  host: "project.local"
  path: "/"
  tls: false

config:
  exampleValue: "placeholder"
  logLevel: "info"

secretValues:
  exampleSecret: "to-replace"

# Persistent storage configuration
persistence:
  enabled: false
  mountPath: "/usr/share/app-data"
  hostPath: "/mnt/shared"       # VirtualBox shared folder for multi-pod access
  # NFS-backed persistent configuration (used when persistence.enabled = true)
  nfs:
    server: "192.168.56.100"
    path: "/mnt/model"
  # PVC settings
  accessMode: ReadWriteMany
  size: "1Gi"
  claimName: ""

# Prometheus Monitoring Configuration
prometheus:
  enabled: true
  image:
    repository: prom/prometheus
    tag: "v2.45.0"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 9090
  retention: "1d"
  scrapeInterval: "30s"
  evaluationInterval: "30s"
  persistence:
    enabled: false
    size: "1Gi"
  
# ServiceMonitor Configuration
serviceMonitor:
  enabled: true
  interval: "30s"
  scrapeTimeout: "10s"
  
# Application metrics endpoints configuration
# These would be configured when applications are deployed
metricsEndpoints:
  # Placeholder for application services that expose metrics
  # Format: serviceName, port, path
  # Example:
  # - name: "my-app"
  #   port: 9090
  #   path: "/metrics"
  endpoints:
    - name: "frontend"
      port: 8080
      path: "/metrics"
    - name: "model"
      port: 8081
      path: "/metrics"

# Model service configuration (migrated from static manifests)
modelService:
  enabled: true
  image:
    repository: ghcr.io/doda25-team6/model-service
    tag: "v0.1.3"
    pullPolicy: IfNotPresent
  replicaCount: 3
  mountPath: "/app/output"
  service:
    port: 8081
    type: ClusterIP

# Istio Service Mesh Configuration
istio:
  enabled: true
  gateway:
    name: istio-gateway
    selector:
      istio: ingressgateway
    servers:
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
      - "*"
  app:
    destinationRule:
      host: app-service
      trafficPolicy:
        loadBalancer:
          consistentHash:
            httpHeaderName: x-user
      subsets:
      - name: v1
        labels:
          version: v1
      - name: v2
        labels:
          version: v2
    virtualService:
      name: app-entry-service
      gateways:
      - istio-gateway
      hosts:
      - "*"
      http:
      - match:
        - uri:
            prefix: /
        route:
        - destination:
            host: app-service
            subset: v1
          weight: 90
        - destination:
            host: app-service
            subset: v2
          weight: 10
  modelService:
    destinationRule:
      host: model-service
      subsets:
      - name: v1
        labels:
          version: v1
      - name: v2
        labels:
          version: v2
    virtualService:
      name: model-service-vs
      hosts:
      - model-service
      http:
      - match:
        - sourceLabels:
            version: v2
        route:
        - destination:
            host: model-service
            subset: v2
      - route:
        - destination:
            host: model-service
            subset: v1

